<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chemistry Board Game ‚Äì The George Way/title>
<style>
  :root{ --ink:#111; --good:#2ecc71; --bad:#e74c3c; --panel:#ffffffcc; }
  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; background:#ede7e3; font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    display:flex; flex-direction:column; align-items:center; padding:18px; padding-bottom:120px;
  }

  /* Board */
  .board-wrap{
    position:relative; width:min(1200px,95vw); aspect-ratio:16/9; background:#f7f4f1;
    border-radius:16px; overflow:hidden; box-shadow:0 12px 40px #00000022; margin-bottom:92px;
  }
  .board-bg{ position:absolute; inset:0; background:url('board.png') center/contain no-repeat; z-index:1; }

  /* Tokens */
  .token{
    position:absolute; width:26px; height:26px; border-radius:50%; border:2px solid #000;
    transform:translate(-50%,-50%); transition:left .28s ease, top .28s ease;
    z-index:5; box-shadow:0 2px 5px #00000040;
  }
  .p1{ background:#ff5d5d } .p2{ background:#5d9bff } .p3{ background:#50d890 }
  .p4{ background:#ffd166 } .p5{ background:#b07aff }

  /* Center Dice */
  .dice{
    position:absolute; inset:0; margin:auto; width:min(18vmin,140px); height:min(18vmin,140px);
    background:#cc6b6b; border-radius:22px; box-shadow:inset 0 -8px 0 #00000025, 0 10px 25px #00000025;
    display:grid; place-items:center; cursor:pointer; user-select:none; z-index:6;
    transition:transform .1s ease; 
  }
  .dice:active{ transform:scale(.98) }
  .pips{
    width:70%; height:70%; display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(3,1fr); gap:6%;
  }
  .pip{
    width:100%; height:100%; display:flex; align-items:center; justify-content:center;
  }
  .pip::before{ content:""; width:18px; height:18px; border-radius:50%; background:#fff; }
  .hidden{ visibility:hidden }

  .roll-hint{ position:absolute; left:50%; top:56%; transform:translateX(-50%); font-size:14px; background:#ffffffcc; padding:4px 10px; border-radius:999px; z-index:6 }

  /* HUD */
  .hud{ display:flex; flex-wrap:wrap; justify-content:center; gap:12px; }
  .panel{ background:var(--panel); backdrop-filter:blur(4px); border:1px solid #00000018; border-radius:12px; padding:10px 14px; box-shadow:0 8px 24px #00000020 }
  .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
  .btn{ border:0; border-radius:10px; padding:8px 14px; font-weight:700; cursor:pointer; background:#111; color:#fff }
  .btn.alt{ background:#fff; color:#111; border:2px solid #00000022 }
  .chip{ border-radius:999px; padding:4px 10px; background:#00000010; font-weight:700 }
  .chip.dark{ background:#111; color:#fff }

  /* Modal */
  .modal{ position:fixed; inset:0; background:#00000066; display:none; align-items:center; justify-content:center; z-index:50; padding:18px }
  .modal.show{ display:flex }
  .dialog{ background:#fff; width:min(720px,95vw); border-radius:16px; border:2px solid #00000020; padding:18px }
  .dialog h2{ margin:0 0 8px }
  .options{ display:grid; gap:10px; margin-top:10px }
  .optBtn{ border:2px solid #00000020; border-radius:12px; background:#fff; padding:12px; text-align:left; font-weight:700; cursor:pointer }
  .optBtn:hover{ border-color:#00000045 }
  .banner{ padding:10px 12px; border-radius:12px; color:#fff; font-weight:800 }
  .good{ background:var(--good) } .bad{ background:var(--bad) }
</style>
</head>
<body>

<div class="board-wrap" id="board">
  <div class="board-bg" aria-hidden="true"></div>

  <!-- Center Dice Init -->
  <div id="dice" class="dice" title="Roll">
    <div class="pips" id="pips">
   
      <div class="pip" data-pos="1"></div>
      <div class="pip" data-pos="2"></div>
      <div class="pip" data-pos="3"></div>
      <div class="pip" data-pos="4"></div>
      <div class="pip" data-pos="5"></div>
      <div class="pip" data-pos="6"></div>
      <div class="pip" data-pos="7"></div>
      <div class="pip" data-pos="8"></div>
      <div class="pip" data-pos="9"></div>
    </div>
  </div>
  <div class="roll-hint" id="rollHint">Tap dice to roll</div>

  <!-- Tokens -->
  <div id="t1" class="token p1"></div>
  <div id="t2" class="token p2"></div>
  <div id="t3" class="token p3"></div>
  <div id="t4" class="token p4"></div>
  <div id="t5" class="token p5"></div>
</div>

<!-- HUD -->
<div class="hud">
  <div class="panel">
    <div class="row">
      <b>Players:</b>
      <select id="playerCount" class="btn alt" style="padding:6px 10px">
        <option>2</option><option>3</option><option>4</option><option selected>5</option>
      </select>
      <button id="apply" class="btn">Apply</button>
      <button id="reset" class="btn alt">Restart</button>
    </div>
  </div>
  <div class="panel">
    <div class="row">
      <span class="chip dark" id="turnChip">Turn: ‚Äì</span>
      <span class="chip" id="rollChip">Roll to start</span>
    </div>
    <div id="scores" class="row" style="margin-top:8px"></div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal"><div class="dialog"><div id="modalContent"></div></div></div>

<script>
/* ===========================================================
   BOARD LAYOUT & QUESTIONS
   Path order (21 spaces total):
   0 START (bottom-left) ->
   1..5 go UP the left side ->
   6..10 go RIGHT across the top ->
   11..15 go DOWN right side ->
   16..20 go LEFT across the bottom ->
   20 is FINISH (tile before START).
=========================================================== */

// NOT FINISHED NEED TO UPDATE
const BOARD = [
  {type:'start', label:'START'},                                     // 0
  {type:'reaction', text:'Event (1) ‚Äì You put mentos in coke (Big Mistake)', effect:{points:-2}},         // 1
  {type:'reaction', text:'Event (2) ‚Äì +1 point.', effect:{points:+1}},// 2
  {type:'question', q:'Pure water has pH 7. It is:', choices:['Acidic','Basic','Neutral','Corrosive'], answer:'C', points:{correct:2, wrong:-1}}, // 3
  {type:'reaction', text:'Give a sentence with ‚Äúusually.‚Äù', teacher:true}, // 4
  {type:'reaction', text:'Jail Time ‚Äî lose next turn.', effect:{skip:1}},   // 5
  {type:'question', q:'Which bond shares electrons?', choices:['Ionic','Hydrogen','Covalent','Metallic'], answer:'C', points:{correct:2, wrong:-1}}, // 6
  {type:'reaction', text:'Catalyst speeds reaction ‚Äî move +2.', effect:{move:+2}}, // 7
  {type:'reaction', text:'Element found in meteorite ‚Äî +5 pts.', effect:{points:+5}}, // 8
  {type:'reaction', text:'Fake element reported ‚Äî -2 pts.', effect:{points:-2}}, // 9
  {type:'reaction', text:'Say a negative sentence about food.', teacher:true}, // 10
  {type:'reaction', text:'Lucky step ‚Äî +1 pt.', effect:{points:+1}}, // 11
  {type:'question', q:'Which unit measures mass?', choices:['Liter','Celsius','Gram','Meter'], answer:'C', points:{correct:2, wrong:-1}}, // 12
  {type:'reaction', text:'Phosphorus reacts with oxygen ‚Äî move +1.', effect:{move:+1}}, // 13
  {type:'reaction', text:'Stable reaction ‚Äî nothing happens.'}, // 14
  {type:'reaction', text:'Volatile reaction ‚Äî -1 pt.', effect:{points:-1}}, // 15
  {type:'reaction', text:'Correct! +2 pts.', effect:{points:+2}}, // 16
  {type:'reaction', text:'Wrong! -1 pt.', effect:{points:-1}}, // 17
  {type:'reaction', text:'All point taken ‚Äî +3 pts.', effect:{points:+3}}, // 18
  {type:'question', q:'Complete combustion of a hydrocarbon produces:', choices:['O2 & sugar','CO2 & H2O','Methane & heat','CO & ash'], answer:'B', points:{correct:2, wrong:-1}}, // 19
  {type:'finish', label:'FINISH'}                                   // 20
];

/* Pathing*/
function buildPath(){
  const path = [];
  // Start (bottom-left corner area)
  path.push({x:8, y:92});                                 // 0 START

  // Up the left side (1..5)
  path.push({x:10, y:77});  // 1
  path.push({x:10, y:62});  // 2
  path.push({x:10, y:47});  // 3
  path.push({x:10, y:32});  // 4
  path.push({x:10, y:17});  // 5 (top-left)

  // Across the top, left->right (6..10)
  path.push({x:23, y:8});  // 6
  path.push({x:38, y:8});  // 7
  path.push({x:53, y:8});  // 8
  path.push({x:68, y:8});  // 9
  path.push({x:83, y:8});  // 10 (top-right)

  // Down the right side (11..15)
  path.push({x:92, y:23}); // 11
  path.push({x:92, y:38}); // 12
  path.push({x:92, y:53}); // 13
  path.push({x:92, y:68}); // 14
  path.push({x:92, y:83}); // 15 (bottom-right)

  // Across the bottom, right->left (16..20)
  path.push({x:77, y:92}); // 16
  path.push({x:62, y:92}); // 17
  path.push({x:47, y:92}); // 18
  path.push({x:32, y:92}); // 19
  path.push({x:23, y:92}); // 20 FINISH (tile before START)
  return path;
}
const PATH = buildPath(); // length = 21 (0..20)

/* Player Names (aka the idiots */
const NAMES_DEFAULT = ["George","Angie","Kobe","Walter","Alexander"];


const boardEl = document.getElementById('board');
const diceEl  = document.getElementById('dice');
const pipsEl  = document.getElementById('pips');
const rollHint= document.getElementById('rollHint');
const scoresRow = document.getElementById('scores');
const turnChip  = document.getElementById('turnChip');
const rollChip  = document.getElementById('rollChip');
document.getElementById('apply').onclick = ()=> boot(Number(document.getElementById('playerCount').value||5));
document.getElementById('reset').onclick = ()=> boot(Number(document.getElementById('playerCount').value||5));

/* States */
let players = [];  
let current = 0;
let locked  = false;

function boot(n=5){
  // Init the players (aka idiots :P
  players = Array.from({length:n}, (_,i)=>({
    name: NAMES_DEFAULT[i] || `Player ${i+1}`,
    pos: 0, score: 0, skip: 0, done: false,
    token: document.getElementById('t'+(i+1))
  }));
  // hide extra tokens if <5
  for(let i=0;i<5;i++){
    const t = document.getElementById('t'+(i+1));
    t.style.display = i<n ? 'block' : 'none';
  }
  // place tokens side-by-side at START (NOT WORKING :(
  players.forEach((p,i)=> placeToken(p, 0, startNudge(i)) );
  // UI
  renderScores(); current = 0; updateTurn(); rollChip.textContent = 'Roll to start';
  locked=false; rollHint.style.display='';
}

function startNudge(i){ // spread horizontally at start
  return [{dx:-10,dy:-8},{dx:+10,dy:-8},{dx:-10,dy:+8},{dx:+10,dy:+8},{dx:0,dy:0}][i%5];
}
function tokenNudge(i){ // small spread everywhere else
  return [{dx:-6,dy:-6},{dx:+6,dy:-6},{dx:+6,dy:+6},{dx:-6,dy:+6},{dx:0,dy:0}][i%5];
}

function renderScores(){
  scoresRow.innerHTML = '';
  players.forEach((p,i)=>{
    const chip = document.createElement('span');
    chip.className = 'chip';
    chip.id = `chip${i}`;
    chip.innerHTML = `<b>${p.name}</b>: <span id="sc${i}">${p.score}</span> pts ¬∑ Space <span id="sp${i}">${p.pos}</span>${p.done?' ¬∑ ‚úÖ Finished':''}`;
    scoresRow.appendChild(chip);
  });
}
function updateTurn(){ turnChip.textContent = `Turn: ${players[current].name}`; }

function placeToken(player, idx, nudge={dx:0,dy:0}){
  const {x,y} = PATH[idx];
  player.token.style.left = `${x}%`;
  player.token.style.top  = `${y}%`;
  player.token.style.transform = `translate(-50%,-50%) translate(${nudge.dx}px,${nudge.dy}px)`;
}

/* Dice Pips :) */
const pipsMap = {
  1:[5],
  2:[1,9],
  3:[1,5,9],
  4:[1,3,7,9],
  5:[1,3,5,7,9],
  6:[1,3,4,6,7,9]
};
function showPips(n){
  const cells = pipsEl.querySelectorAll('.pip');
  cells.forEach(c=>c.classList.add('hidden'));
  (pipsMap[n]||[]).forEach(pos=>{
    const el = pipsEl.querySelector(`.pip[data-pos="${pos}"]`);
    if(el) el.classList.remove('hidden');
  });
}

/* Movement and Turning logic */
diceEl.addEventListener('click', ()=>{
  if (locked) return;
  // find a player who isn't done (always rolls)
  if (players.filter(p=>!p.done).length===0) return; // game already finished (all done)
  if (players[current].done) { nextTurn(); return; }

  const p = players[current];
  if (p.skip>0){ p.skip--; toast(`${p.name} skips this turn.`); nextTurn(); return; }

  locked = true; rollHint.style.display='none';

  // roll 1..6
  const roll = Math.floor(Math.random()*6)+1;
  showPips(roll);
  rollChip.textContent = `Rolled ${roll}`;

  
  let steps = roll;
  const step = ()=>{
    if (steps<=0 || p.pos>=20){ // reached FINISH already or out of steps
      landed(); return;
    }
    p.pos = Math.min(p.pos+1, 20);
    document.getElementById('sp'+current).textContent = p.pos;
    placeToken(p, p.pos, tokenNudge(current));
    steps--;
    setTimeout(step, 250);
  };
  step();
});

function landed(){
  const p = players[current];
  const tile = BOARD[p.pos];

  if (p.pos===20 && !p.done){ // FINISH
    deltaScore(current, +3);
    p.done = true;
    document.getElementById('chip'+current).innerHTML =
      `<b>${p.name}</b>: <span id="sc${current}">${p.score}</span> pts ¬∑ Space <span id="sp${current}">${p.pos}</span> ¬∑ ‚úÖ Finished`;
    toast(`üéâ ${p.name} reached FINISH! (+3 pts)`);
  }

  if (p.done){
    locked=false;
    // if everyone finished, announce winner
    if (players.every(pp=>pp.done)){
      const max = Math.max(...players.map(pp=>pp.score));
      const winners = players.filter(pp=>pp.score===max).map(pp=>pp.name);
      openModal(`<h2>Game Over</h2>
        <div style="font-size:18px">Winner${winners.length>1?'s':''}: <b>${winners.join(', ')}</b> with <b>${max}</b> pts.</div>
        <div style="text-align:right;margin-top:12px"><button class="btn" id="ok">OK</button></div>`);
      modal.querySelector('#ok').addEventListener('click',()=>closeModal());
    }
    nextTurn(); return;
  }

  if (!tile){ locked=false; nextTurn(); return; }
  if (tile.type==='question'){ showQuestion(tile); return; }
  if (tile.type==='reaction'){ applyReaction(tile); return; }
  locked=false; nextTurn();
}

function deltaScore(i, n){
  players[i].score += n;
  document.getElementById('sc'+i).textContent = players[i].score;
}

function nextTurn(){
  // advance to next non-finished player
  let tries=0;
  do{
    current = (current+1) % players.length;
    tries++;
    if (tries>players.length+2) break; // safety
  } while(players[current].done);
  updateTurn();
}

/* Helpers  */
const modal=document.getElementById('modal');
const modalContent=document.getElementById('modalContent');
function openModal(html){ modalContent.innerHTML=html; modal.classList.add('show'); }
function closeModal(){ modal.classList.remove('show'); }
modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

function toast(text){
  openModal(`<div class="banner" style="background:#111">${text}</div>
    <div style="text-align:right;margin-top:10px"><button class="btn" id="ok">OK</button></div>`);
  modal.querySelector('#ok').addEventListener('click',()=>closeModal());
}

function showQuestion(tile){
  const letters=['A','B','C','D'];
  const opts = tile.choices.map((t,idx)=>`<button class="optBtn" data-k="${letters[idx]}"><b>${letters[idx]}.</b> ${t}</button>`).join('');
  openModal(`<h2>Question</h2><div style="font-size:18px">${tile.q}</div><div class="options">${opts}</div>`);
  modal.querySelectorAll('.optBtn').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const k = e.currentTarget.getAttribute('data-k');
      const correct = tile.answer;
      if (k===correct){
        const gain = tile.points?.correct ?? 2;
        deltaScore(current, gain);
        openModal(`<div class="banner good">‚úÖ Correct! +${gain} pts</div>
          <div style="text-align:right;margin-top:10px"><button class="btn" id="go">Continue</button></div>`);
      }else{
        const loss = tile.points?.wrong ?? -1;
        deltaScore(current, loss);
        openModal(`<div class="banner bad">‚ùå Wrong. ${loss} pt</div>
          <div style="text-align:right;margin-top:10px"><button class="btn" id="go">Continue</button></div>`);
      }
      modal.querySelector('#go').addEventListener('click', ()=>{ closeModal(); locked=false; nextTurn(); });
    });
  });
}

function applyReaction(tile){
  if (tile.teacher){
    openModal(`<h2>Reaction</h2><div style="font-size:18px">${tile.text}</div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn alt" id="no">Mark Wrong (‚àí1)</button>
        <button class="btn" id="yes">Mark Correct (+2)</button>
      </div>`);
    modal.querySelector('#yes').addEventListener('click',()=>{ deltaScore(current,+2); closeModal(); locked=false; nextTurn(); });
    modal.querySelector('#no').addEventListener('click',()=>{ deltaScore(current,-1); closeModal(); locked=false; nextTurn(); });
    return;
  }

  let msg = tile.text || 'Event';
  const eff = tile.effect || {};
  if (eff.points){ deltaScore(current, eff.points); msg += ` (${eff.points>0?'+':''}${eff.points} pts)`; }
  if (eff.move){
    const p = players[current];
    p.pos = Math.min(p.pos + eff.move, 20);
    document.getElementById('sp'+current).textContent = p.pos;
    placeToken(p, p.pos, tokenNudge(current));
    msg += ` (moved ${eff.move>0?'+':''}${eff.move})`;
  }
  if (eff.skip){ players[current].skip = Math.max(0, players[current].skip + eff.skip); msg += eff.skip>0?` (skip next ${eff.skip})`:` (skip removed)`; }

  openModal(`<h2>Reaction</h2><div style="font-size:18px">${msg}</div>
    <div style="text-align:right;margin-top:10px"><button class="btn" id="ok">Continue</button></div>`);
  modal.querySelector('#ok').addEventListener('click', ()=>{ closeModal(); locked=false; nextTurn(); });
}

/* Keep tokens aligned */
window.addEventListener('resize', ()=> players.forEach((p,i)=> placeToken(p,p.pos, p.pos===0?startNudge(i):tokenNudge(i)) ) );

/* Final Initialization */
boot(5);
showPips(1); // show faces at boot
</script>
</body>
</html>


